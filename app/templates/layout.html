<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>{{ title if title else "Harvestify" }}</title>
	<link rel="shortcut icon" href="{{ url_for('static', filename='images/favicon.ico') }}" />

	<!-- Fonts & Icons -->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
		rel="stylesheet">

	<!-- Vendor CSS -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

	<!-- Local CSS -->
	<link href="{{ url_for('static', filename='css/bootstrap.css') }}" rel="stylesheet" type="text/css" />
	<link href="{{ url_for('static', filename='css/font-awesome.min.css') }}" rel="stylesheet">
	<link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet" type="text/css" />
</head>

<body class="app-shell">
	<header class="app-header shadow-sm">
		<nav class="navbar navbar-expand-lg navbar-light py-3">
			<div class="container">
				<a class="navbar-brand d-flex align-items-center" href="{{ url_for('home') }}">
					<img src="{{ url_for('static', filename='images/logo.png') }}" alt="Harvestify logo"
						class="brand-mark mr-2" />
					<div>
						<div class="brand-title">Harvestify</div>
						<small class="brand-tagline text-muted">Insightful farming decisions</small>
					</div>
				</a>
				<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive"
					aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
				<div class="collapse navbar-collapse" id="navbarResponsive">
					<ul class="navbar-nav ml-auto align-items-lg-center">
						<li class="nav-item {% if request.endpoint == 'home' %}active{% endif %}">
							<a class="nav-link" href="{{ url_for('home') }}">Home</a>
						</li>
						<li class="nav-item {% if 'crop' in request.endpoint %}active{% endif %}">
							<a class="nav-link" href="{{ url_for('crop_recommend') }}">Crop</a>
						</li>
						<li class="nav-item {% if 'fertilizer' in request.endpoint %}active{% endif %}">
							<a class="nav-link" href="{{ url_for('fertilizer_recommendation') }}">Fertilizer</a>
						</li>
						<li class="nav-item {% if 'disease' in request.endpoint %}active{% endif %}">
							<a class="nav-link" href="{{ url_for('disease_prediction') }}">Disease</a>
						</li>
						<li class="nav-item d-none d-lg-block">
							<a class="btn btn-success ml-lg-3 px-4" href="{{ url_for('crop_recommend') }}">Get Started</a>
						</li>
					</ul>
				</div>
			</div>
		</nav>
	</header>

	<main class="app-main py-5">
		<div class="container">
			{% with messages = get_flashed_messages(with_categories=true) %}
			{% if messages %}
			<div class="mb-4">
				{% for category, message in messages %}
				<div class="alert alert-{{ category }} shadow-sm mb-2" role="alert">
					{{ message }}
				</div>
				{% endfor %}
			</div>
			{% endif %}
			{% endwith %}
			{% block body %}{% endblock %}
		</div>
	</main>

	<footer class="app-footer py-5">
		<div class="container text-center">
			<p class="mb-1 font-weight-semibold">Harvestify</p>
			<p class="mb-2 text-muted">Made with care by Jay</p>
			<small class="text-muted">&copy; {{ current_year if current_year is defined else '2025' }} Harvestify. All
				rights reserved.</small>
		</div>
	</footer>

	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

	<!-- Diagnostic: check jQuery and Bootstrap collapse plugin, add fallback toggle -->
	<script>
		(function(){
			try {
				console.log('Navbar diagnostic: jQuery version', window.jQuery && jQuery.fn && jQuery.fn.jquery);
				console.log('Bootstrap collapse plugin:', window.jQuery && jQuery.fn && !!jQuery.fn.collapse);

				// If bootstrap collapse plugin missing, attach a simple fallback
				if (!window.jQuery || !jQuery.fn || !jQuery.fn.collapse) {
					var toggler = document.querySelector('.navbar-toggler');
					var collapse = document.getElementById('navbarResponsive');
					if (toggler && collapse) {
						toggler.addEventListener('click', function(e){
							e.preventDefault();
							collapse.classList.toggle('show');
							console.log('Fallback toggler used, show=', collapse.classList.contains('show'));
						});
						console.warn('Bootstrap collapse plugin not detected â€” fallback toggle attached.');
					}
				} else {
					// Log show/hide events to help debugging
					jQuery('#navbarResponsive').on('show.bs.collapse', function(){ console.log('navbar collapse show'); });
					jQuery('#navbarResponsive').on('hide.bs.collapse', function(){ console.log('navbar collapse hide'); });
				}
			} catch(err) {
				console.error('Navbar diagnostic error', err);
			}
		})();
	</script>

	<script src="{{ url_for('static', filename='scripts/cities.js') }}"></script>
	{% block scripts %}{% endblock %}
</body>

</html>